<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>√în T·∫≠p Tr·∫Øc Nghi·ªám ‚Äì D·ªÖ Th∆∞∆°ng</title>
<style>
    body {
        font-family: "Comic Sans MS", Arial;
        background: linear-gradient(#dff3ff, #fef6ff);
        padding: 20px;
    }
    h1 {
        text-align: center;
        color: #ff6f91;
        text-shadow: 2px 2px #ffe7ef;
    }

    .subject-btn {
        padding: 14px 24px;
        margin: 8px;
        background: #ff9ec4;
        color: white;
        border: none;
        border-radius: 14px;
        cursor: pointer;
        font-size: 18px;
        box-shadow: 0 4px #e67faa;
        transition: 0.2s;
    }
    .subject-btn:hover {
        background: #ff76ad;
    }

    #quiz-box {
        display:none;
        background:white;
        padding:25px;
        border-radius:20px;
        max-width:750px;
        margin:auto;
        box-shadow:0 0 20px rgba(255,150,200,0.5);
        border:4px solid #ffd6e8;
    }

    #question-text {
        font-size:20px;
        font-weight:bold;
        color:#ff6f91;
        margin-bottom:10px;
    }

    .answer {
        padding:12px;
        border:2px solid #cce6ff;
        border-radius:12px;
        margin-top:10px;
        cursor:pointer;
        background:#f2faff;
        transition:0.2s;
    }
    .answer:hover {
        background:#dff1ff;
    }

    .correct {
        background:#c3ffcf !important;
        border-color:#52d468;
    }
    .wrong {
        background:#ffd3d3 !important;
        border-color:#ff6b6b;
    }

    #controls {
        margin-top:20px;
        text-align:center;
    }
    button {
        padding:12px 20px;
        margin:8px;
        border:none;
        border-radius:10px;
        font-size:16px;
        cursor:pointer;
    }
    #next-btn { background:#6ecbff; color:white; box-shadow:0 3px #4aa8dd; }
    #see-answer-btn { background:#ffb347; color:white; box-shadow:0 3px #db9831; }
    #restart-btn { background:#8ef58e; color:white; box-shadow:0 3px #63d263; }

    /* b·∫£ng k·∫øt qu·∫£ */
    #result-box {
        display:none;
        background:white;
        padding:20px;
        border-radius:16px;
        max-width:650px;
        margin:20px auto;
        box-shadow:0 0 15px rgba(150,200,255,0.5);
        border:3px solid #bfe4ff;
        text-align:center;
    }
    #result-box h2 { color:#ff6f91; }
</style>
</head>

<body>

<h1>üåü √în T·∫≠p Ki·∫øn Th·ª©c ‚Äì H·ªçc M√† Ch∆°i üåü</h1>

<div id="subject-box" style="text-align:center;">
    <button class="subject-btn" onclick="loadSubject('cn3.json')">C√¥ng Ngh·ªá 3</button>
    <button class="subject-btn" onclick="loadSubject('th3.json')">Tin H·ªçc 3</button><br>
    <button class="subject-btn" onclick="loadSubject('cn4.json')">C√¥ng Ngh·ªá 4</button>
    <button class="subject-btn" onclick="loadSubject('th4.json')">Tin H·ªçc 4</button><br>
    <button class="subject-btn" onclick="loadSubject('cn5.json')">C√¥ng Ngh·ªá 5</button>
    <button class="subject-btn" onclick="loadSubject('th5.json')">Tin H·ªçc 5</button>
</div>

<!-- ================= KHUNG C√ÇU H·ªéI ================= -->
<div id="quiz-box">
    <h2 id="question-text"></h2>
    <div id="answers"></div>

    <div id="controls">
        <button id="next-btn" onclick="nextQuestion()">C√¢u ti·∫øp ‚ûú</button>
        <button id="see-answer-btn" onclick="showEssayAnswer()" style="display:none;">
            Xem ƒë√°p √°n
        </button>
    </div>
</div>

<!-- ================ B·∫¢NG K·∫æT QU·∫¢ ================ -->
<div id="result-box">
    <h2>üéâ Ho√†n th√†nh b√†i l√†m! üéâ</h2>
    <p id="mcq-score"></p>
    <p id="essay-score"></p>
    <h3 id="total-score"></h3>

    <button id="restart-btn" onclick="restartQuiz()">üîÑ L√†m l·∫°i</button>
</div>

<script>
let data = [];
let mcq = [];
let essay = [];
let index = 0;
let scoreMCQ = 0;       
let scoreEssay = 0;     
let viewedEssay = {};   

function loadSubject(filename) {
    fetch(filename)
    .then(res => res.json())
    .then(json => {
        data = json;
        mcq = data.filter(q => !q.type);
        essay = data.filter(q => q.type === "essay");

        mcq = shuffle(mcq);

        index = 0;
        scoreMCQ = 0;
        scoreEssay = 0;
        viewedEssay = {};

        document.getElementById("subject-box").style.display = "none";
        document.getElementById("result-box").style.display = "none";
        document.getElementById("quiz-box").style.display = "block";

        showQuestion();
    });
}

function showQuestion() {
    let q;

    if (index < mcq.length) q = mcq[index];
    else q = essay[index - mcq.length];

    document.getElementById("answers").innerHTML = "";
    document.getElementById("question-text").innerText =
        "C√¢u " + (index + 1) + ": " + q.question;

    if (!q.type) {
        document.getElementById("next-btn").style.display = "inline-block";
        document.getElementById("see-answer-btn").style.display = "none";

        q.options.forEach((opt, i) => {
            let div = document.createElement("div");
            div.className = "answer";
            div.innerText = opt;
            div.onclick = () => checkAnswer(div, i, q.answer);
            document.getElementById("answers").appendChild(div);
        });
    } else {
        document.getElementById("answers").innerHTML =
            "<p style='font-size:18px; color:#777;'>H√£y t·ª± ƒë·ªçc v√† suy nghƒ© tr∆∞·ªõc khi b·∫•m xem ƒë√°p √°n nh√©!</p>";

        document.getElementById("see-answer-btn").style.display = "inline-block";
    }
}

function checkAnswer(div, idx, correctLetter) {
    let letter = ["A","B","C","D"][idx];

    if (letter === correctLetter) {
        div.classList.add("correct");
        scoreMCQ += 0.5;
    } else {
        div.classList.add("wrong");
    }

    document.querySelectorAll(".answer").forEach(a => a.onclick = null);
}

function showEssayAnswer() {
    let q = essay[index - mcq.length];

    if (!viewedEssay[q.id]) {
        scoreEssay += 0.5;
        viewedEssay[q.id] = true;
    }

    alert("üìò ƒê√°p √°n:\n" + q.answer);
}

function nextQuestion() {
    index++;

    if (index < mcq.length + essay.length) {
        showQuestion();
    } else {
        showResult();
    }
}

function showResult() {
    document.getElementById("quiz-box").style.display = "none";
    document.getElementById("result-box").style.display = "block";

    document.getElementById("mcq-score").innerText =
        "üí° ƒêi·ªÉm tr·∫Øc nghi·ªám: " + scoreMCQ.toFixed(1);

    document.getElementById("essay-score").innerText =
        "üìù ƒêi·ªÉm t·ª± lu·∫≠n (ƒë√£ xem ƒë√°p √°n): " + scoreEssay.toFixed(1);

    let total = (scoreMCQ + scoreEssay).toFixed(1);

    document.getElementById("total-score").innerHTML =
        "<b>‚≠ê T·ªïng ƒëi·ªÉm: " + total + " / 10 ‚≠ê</b>";
}

function restartQuiz() {
    location.reload();
}

function shuffle(arr) {
    return arr.sort(() => Math.random() - 0.5);
}
</script>

</body>
</html>
