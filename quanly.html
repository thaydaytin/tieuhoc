<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω l·ªõp h·ªçc</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      text-align: center;
      padding: 50px;
    }
    #loginBox, #classManager {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 600px;
      margin: auto;
    }
    input[type=password], select {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
    }
    button {
      padding: 10px 20px;
      border: none;
      background: #3498db;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    button:active {
      transform: scale(0.9);
      transition: transform 0.1s;
    }
    #error {
      color: red;
      margin-top: 10px;
    }
    .student { 
      display: flex; 
      align-items: center; 
      margin: 8px 0; 
      padding: 10px 0; 
      border-bottom: 1px solid #ddd;
    }
    .name { flex: 1; text-align: left; }
    .like, .dislike { margin-left: 10px; cursor: pointer; font-size: 16px; }
    .effect {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      font-weight: bold;
      opacity: 0;
      animation: popUp 0.5s forwards;
    }
    .effect.plus { color: green; }
    .effect.minus { color: red; }
    @keyframes popUp {
      0% { opacity: 1; transform: translateX(-50%) translateY(0); }
      100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
    }
  </style>
</head>
<body>
  <div id="loginBox">
    <h2>üîê Nh·∫≠p m·∫≠t kh·∫©u</h2>
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u">
    <button onclick="checkPassword()">ƒêƒÉng nh·∫≠p</button>
    <div id="error"></div>
  </div>

  <div id="classManager" style="display:none;">
    <h2>üìö Trang qu·∫£n l√Ω l·ªõp h·ªçc</h2>
    <label for="classSelect">Ch·ªçn l·ªõp: </label>
    <select id="classSelect" onchange="loadStudents()">
      <option value="">-- Ch·ªçn l·ªõp --</option>
      <option value="3A">3A</option>
      <option value="3B">3B</option>
      <option value="3C">3C</option>
      <option value="4A">4A</option>
      <option value="4B">4B</option>
      <option value="4C">4C</option>
      <option value="5A">5A</option>
      <option value="5B1">5B1</option>
      <option value="5B2">5B2</option>
      <option value="5C">5C</option>
    </select>
    <div id="studentList"></div>
    <button onclick="copyStudents()">üìã Copy danh s√°ch h·ªçc sinh</button>
  </div>

  <script>
    // ---------------- M·∫≠t kh·∫©u ƒëƒÉng nh·∫≠p ----------------
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
    }

    async function checkPassword() {
      const password = document.getElementById("password").value;
      const enteredHash = await sha256(password);

      const response = await fetch("pw.json");
      const data = await response.json();
      const correctHash = data.hash;

      if (enteredHash === correctHash) {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("classManager").style.display = "block";
      } else {
        document.getElementById("error").innerText = "‚ùå M·∫≠t kh·∫©u sai!";
      }
    }

    // ---------------- Qu·∫£n l√Ω l·ªõp h·ªçc ----------------
    const scriptUrl = "https://script.google.com/macros/s/AKfycbz-hJBaS4uxYfSW3oEmYnDBlsXl-U0HdPSvgZTNWp-yMwx6nCjR6wyOOPvHyRWKSRhwzw/exec"; // Thay b·∫±ng URL Apps Script

    async function loadStudents() {
      const className = document.getElementById("classSelect").value;
      if (!className) {
        document.getElementById("studentList").innerHTML = "";
        return;
      }

      let res = await fetch(`${scriptUrl}?class=${className}`);
      let data = await res.json();
      let students = data.slice(1); // b·ªè d√≤ng ti√™u ƒë·ªÅ

      let html = `<h3>L·ªõp ${className}</h3>`;
      students.forEach(s => {
        html += `
          <div class="student">
            <div class="name">${s[1]}</div>
            <button class="like" onclick="updatePoint('${className}','${s[0]}','like', this)">üëç</button>
            <button class="dislike" onclick="updatePoint('${className}','${s[0]}','dislike', this)">üëé</button>
          </div>
        `;
      });
      document.getElementById("studentList").innerHTML = html;
    }
   
    async function copyStudents() {
    const className = document.getElementById("classSelect").value;
    if (!className) {
      alert("Vui l√≤ng ch·ªçn l·ªõp tr∆∞·ªõc!");
      return;
    }
  
    let res = await fetch(`${scriptUrl}?class=${className}`);
    let data = await res.json();
    let students = data.slice(1); // b·ªè d√≤ng ti√™u ƒë·ªÅ
  
    // L·∫•y c·ªôt t√™n h·ªçc sinh (c·ªôt 2 trong sheet)
    let listText = students.map(s => s[1]).join("\\n");
  
    // Copy v√†o clipboard
    try {
      await navigator.clipboard.writeText(listText);
      alert("‚úÖ Danh s√°ch h·ªçc sinh l·ªõp " + className + " ƒë√£ ƒë∆∞·ª£c copy!");
    } catch (err) {
      alert("‚ùå Kh√¥ng th·ªÉ copy t·ª± ƒë·ªông, vui l√≤ng copy th·ªß c√¥ng.");
    }
  }

    async function updatePoint(className, id, action, el) {
      // Hi·ªáu ·ª©ng +1 ho·∫∑c -1
      const effect = document.createElement("div");
      effect.className = action === "like" ? "effect plus" : "effect minus";
      effect.textContent = action === "like" ? "+1" : "-1";
      el.appendChild(effect);
      setTimeout(() => effect.remove(), 500);

      await fetch(scriptUrl, {
        method: "POST",
        body: JSON.stringify({ id, action, class: className })
      });
      loadStudents();
    }
  </script>
</body>
</html>
